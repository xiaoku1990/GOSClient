webpackJsonp([20],{"/xvr":function(i,t){},XRc3:function(i,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e=o("3cXf"),a=o.n(e),r=o("a3Yh"),s=o.n(r),n=o("yB3Q"),l={name:"parking-state",components:{},data:function(){return{provice:["京","津","沪","渝","翼","豫","云","辽","黑","湘","皖","鲁","新","苏","浙","赣","鄂","桂","甘","晋","蒙","陕","吉","闽","贵","粤","青","藏","川","宁","琼"],stateMsg:!0,mapVehicle:!1,userInfo:{},changeColor:"#cccccc",featureDate:"",oldFeatureDate:"",carNumberSrc:"",popupLayer:"",parkMap:"",carInfoShow:!1,carNumShow:!1,edit:!0,editModel:!1,addModel:!1,submitShow:!1,submitVisible:!1,delVisible:!1,inputCarnum:"",VipCarInfo:{},vipCar_numbers:[],floorName:"",floorId:"",stateData:[],vipCarList:[],batchAdd:!0,addVipCarArr:[]}},created:function(){var i=localStorage.getItem("userInfo");this.userInfo=JSON.parse(i);this.$Api,this.userInfo.user_id,null!=this.floorId&&void 0!=this.floorId&&""!=this.floorId&&this.floorId;console.log(this.floorId)},mounted:function(){var i=this;this.pushTaggle="true"===localStorage.getItem("messagePush");var t=new n.a.BeefindMap(s()({target:this.$refs.mybox,floorUl:this.$refs.floorUl,mapType:"screenControl",urlLocal:this.$Api,city_id:this.$CityId,build_id:this.$BuildId,floor_id:"",floorBarVisible:!0,carLayerVisible:!0,carPortLayerVisible:!0,interLayerVisible:!0,deviceLayerVisible:!1},"deviceLayerVisible",!1));i.parkMap=t,i.floorId=t.floorId;var o=new ol.Overlay({element:i.$refs.popup,positioning:"top-center",stopEvent:!0,offset:[0,-25]});i.popupLayer=o,i.parkMap.addOverlay(i.popupLayer),i.parkMap.on("singleclick",function(t){var o=i.parkMap.forEachFeatureAtPixel(t.pixel,function(i){return i});if(console.log(o),o)if(i.featureDate=o,"car"==o.type||"carEvent"==o.type)if(i.addModel)o.VipCar?(i.carInfoShow=!1,i.warn("该车位已添加,请选择其他车位!")):(i.carInfoShow=!0,o.choseCar?i.warn("该车位已添加,请选择其他车位!"):(i.oldFeatureDate&&i.oldFeatureDate.setCarColor("#969696"),"car"==o.type?o.setCarColor("#7460ee"):(o=n.a.findCarFeature(o)).setCarColor("#7460ee"),i.oldFeatureDate=o,i.VipCarInfo=o,i.vipCar_numbers=i.VipCarInfo.car_numbers,i.filterFeature(o)));else if(o.VipCar){console.log("为VIP车位!");o.carposPoint;i.VipCarInfo=o,n.a.addVipIcon(i.VipCarInfo),i.carInfoShow=!0,i.vipCar_numbers=i.VipCarInfo.car_numbers,console.log(i.VipCarInfo)}else i.warn("请开启添加按钮!"),n.a.addVipIcon(null),i.carInfoShow=!1;else n.a.addVipIcon(null),i.warn("请点击你要添加的车位!")}),i.initParkInfo(i.parkMap.floor,i.parkMap.carpos_sum);var e=localStorage.getItem("userInfo");i.userInfo=JSON.parse(e);var a=i.$Api+"/GOSSystem/vipCarList",r=i.userInfo.user_id;null!=i.floorId&&void 0!=i.floorId&&""!=i.floorId&&i.floorId;console.log(i.floorId),i.getVipCarList(a,i.$BuildId,i.floorId,r)},beforeDestroy:function(){this.parkMap.removeEventListener("singleclick"),n.a.clearStateInter(),this.parkMap="",n.a.addVipIcon(null)},methods:{mapImg:function(){this.mapVehicle=!0},mapDialog:function(){this.mapVehicle=!1},initParkInfo:function(i,t){this.floorName=i},deleteCarNumsList:function(i,t,o){this.editModel||this.addModel?i.splice(o,1):this.warn("如何想删除车牌,请进入编辑模式!")},submit:function(){this.submitVisible=!0},stateClose:function(){},stateClick:function(){},upFloor:function(){var i=this,t=i.userInfo.user_id,o=i.$Api+"/GOSSystem/vipCarList";console.log(o);var e=null!=this.floorId&&void 0!=this.floorId&&""!=this.floorId?this.floorId:"Lx01";console.log(e),n.a.upFloor(function(e,a){i.floorName=e,i.floorId=a,i.initParkInfo(i.parkMap.floor,i.parkMap.carpos_sum),i.getVipCarList(o,i.$BuildId,i.floorId,t)}),i.carInfoShow=!1,n.a.addVipIcon(null)},downFloor:function(){var i=this,t=i.$Api+"/GOSSystem/vipCarList",o=i.userInfo.user_id;n.a.downFloor(function(e,a){i.floorName=e,i.floorId=a,i.initParkInfo(i.parkMap.floor,i.parkMap.carpos_sum),i.getVipCarList(t,i.$BuildId,i.floorId,o)}),i.carInfoShow=!1,n.a.addVipIcon(null)},openDialog:function(){this.dialogVisible=!0},warn:function(i){this.$message({message:i,type:"warning",center:!0})},specialWarn:function(){this.$message({message:"该车为特殊车辆!无权限查看!",type:"warning",center:!0})},featureWarn:function(){this.$message({message:"查看车牌请点击车位!",type:"warning",center:!0})},hideOverLayer:function(){this.featureDate="",this.popupLayer.setPosition(void 0)},getVipCarList:function(i,t,o,e){var a=this,r=new URLSearchParams;r.append("build_id",t),r.append("floor_id",o),r.append("user_id","beefind001"),this.$http.post(i,r,{timeout:2e3,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(i){console.log(i),"1"==i.data.result?i.data.vipcar_list.length>=1?(a.vipCarList=[],a.vipCarList=i.data.vipcar_list,n.a.setVipCarColor(a.vipCarList,"#ffc6ee")):a.warn("Vip车位列表为空"):(a.vipCarList=[],a.warn("获取VIP车位列表失败!"))}).catch(function(i){a.$notify({title:"ERROR",message:""+i,duration:2e3,type:"error"})})},addCarnums:function(){console.log(this.inputCarnum.length),0==this.inputCarnum.length?this.warn("输入车牌不能为空!"):this.inputCarnum.length>=7?-1==this.inputCarnum.search(/^[\u4e00-\u9fa5]{1}[A-Z]{1}[A-Z_0-9]{5,}$/)?this.warn("输入车牌不符合规则!"):this.provice.includes(this.inputCarnum.substring(0,1))?this.vipCar_numbers.length<3?(console.log(this.vipCar_numbers.includes(this.inputCarnum)),this.vipCar_numbers.includes(this.inputCarnum)?(this.warn("该车牌已经添加,请输入新的车牌!"),this.inputCarnum=""):(this.vipCar_numbers.push(this.inputCarnum),this.inputCarnum="")):this.warn("最多只能添加3个车牌!"):this.warn("输入车牌不符合规则!"):this.warn("输入车牌位数不得少于7位!")},confirmSubmit:function(){if(this.submitVisible=!1,console.log("添加模式==>"+this.addModel),console.log("编辑模式==>"+this.editModel),this.addModel){var i,t={};t.user_id=this.userInfo.user_id,t.build_id=this.addVipCarArr[0].build_id,t.floor_id=this.addVipCarArr[0].floor_id,t.add_carpos={},t.add_carpos.carpos_name=this.addVipCarArr[0].carNum,t.add_carpos.car_numbers=this.addVipCarArr[0].car_numbers,t.add_carpos.carpos_gid=this.addVipCarArr[0].carUID,t.add_carpos.carpos_areaID=this.addVipCarArr[0].carArea,console.log(t),i=this.$Api+"/GOSSystem/addCarposToVIP",this.addCarposToVip(i,t)}else{console.log(this.VipCarInfo);var o,e={};e.user_id=this.userInfo.user_id,e.build_id=this.VipCarInfo.build_id,e.floor_id=this.VipCarInfo.floor_id,e.edit_carpos={},e.edit_carpos.carpos_name=this.VipCarInfo.carNum,e.edit_carpos.car_numbers=this.VipCarInfo.car_numbers,e.edit_carpos.carpos_gid=this.VipCarInfo.carUID,e.edit_carpos.carpos_areaID=this.VipCarInfo.carArea,console.log(e),o=this.$Api+"/GOSSystem/editVIPCarpos",this.editVipCar(o,e)}},confirmDel:function(){this.delVisible=!this.delVisible;var i,t={};t.user_id=this.userInfo.user_id,t.build_id=this.VipCarInfo.build_id,t.floor_id=this.VipCarInfo.floor_id,t.delete_carpos={},t.delete_carpos.carpos_name=this.VipCarInfo.carNum,t.delete_carpos.carpos_gid=this.VipCarInfo.carUID,t.delete_carpos.carpos_areaID=this.VipCarInfo.carArea,console.log(t),i=this.$Api+"/GOSSystem/deleteCarposFromVIP",this.deleteCarposFromVip(i,t)},canaleEdit:function(){this.editModel=!1,this.edit=!0,this.carNumShow=!1,this.submitShow=!1},startEdit:function(){this.editModel=!0,this.edit=!1,this.carNumShow=!0,this.submitShow=!0},addVipCarModel:function(){this.addModel=!this.addModel,n.a.addVipIcon(null),this.carNumShow=!0,this.submitShow||(this.submitShow=!this.submitShow),this.VipCarInfo=[],this.carInfoShow=!1},canaleVipCarModel:function(){this.addModel=!this.addModel,this.editModel?this.startEdit():this.canaleEdit(),this.addVipCarArr=[],console.log(this.VipCarInfo),n.a.resetFeatureCarColor("#969696",this.VipCarInfo),this.carInfoShow=!1},addCarposToVip:function(i,t){var o=this,e=new URLSearchParams;e.append("build_id",t.build_id),e.append("floor_id",t.floor_id),e.append("user_id",t.user_id),e.append("add_carpos",a()(t.add_carpos)),this.$http.post(i,e,{timeout:2e3,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(i){if(console.log(i),1==i.data.result){var t=o.$Api+"/GOSSystem/vipCarList",e=null!=o.floorId&&void 0!=o.floorId&&""!=o.floorId?o.floorId:"Lx01";console.log(e),o.getVipCarList(t,o.$BuildId,o.floorId,o.userInfo.user_id)}else o.warn("VIP车位添加失败!请重新添加!")}).catch(function(i){o.$notify({title:"ERROR",message:""+i,duration:2e3,type:"error"})})},editVipCar:function(i,t){var o=this,e=new URLSearchParams;e.append("build_id",t.build_id),e.append("floor_id",t.floor_id),e.append("user_id",t.user_id),e.append("edit_carpos",a()(t.edit_carpos)),this.$http.post(i,e,{timeout:2e3,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(i){if(console.log(i),"1"==i.data.result){var t=o.$Api+"/GOSSystem/vipCarList",e=null!=o.floorId&&void 0!=o.floorId&&""!=o.floorId?o.floorId:"Lx01";console.log(e),o.getVipCarList(t,o.$BuildId,o.floorId,o.userInfo.user_id),o.canaleEdit()}else o.warn("编辑VIP车位失败!")}).catch(function(i){o.$notify({title:"ERROR",message:""+i,duration:2e3,type:"error"})})},deleteCarposFromVip:function(i,t){var o=this,e=new URLSearchParams;e.append("build_id",t.build_id),e.append("floor_id",t.floor_id),e.append("user_id",t.user_id),e.append("delete_carpos",a()(t.delete_carpos)),this.$http.post(i,e,{timeout:2e3,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(i){if(console.log(i),"1"==i.data.result){var t=o.$Api+"/GOSSystem/vipCarList";console.log(t);var e=null!=o.floorId&&void 0!=o.floorId&&""!=o.floorId?o.floorId:"Lx01";console.log(e),o.getVipCarList(t,o.$BuildId,o.floorId,o.userInfo.user_id)}else o.warn("删除VIP车位失败!")}).catch(function(i){o.$notify({title:"ERROR",message:""+i,duration:2e3,type:"error"})})},filterFeature:function(i){var t=i;this.addVipCarArr;function o(i){return i==t}console.log(this.addVipCarArr.length),this.addVipCarArr.length<=0?this.addVipCarArr.push(t):(console.log(!this.addVipCarArr.some(o)),this.addVipCarArr.some(o)?(this.addVipCarArr.pop(t),this.VipCarInfo={},t.setCarColor("#969696")):(this.addVipCarArr.splice(0,1),this.addVipCarArr.push(t))),console.log(this.addVipCarArr)}}},d={render:function(){var i=this,t=i.$createElement,e=i._self._c||t;return e("div",{staticClass:"par-state main-padding"},[e("div",{staticClass:"state-one"},[e("div",{staticClass:"state-top"},[e("div",{staticClass:"state-round"},[i._v(i._s(i.floorName)),e("div",{staticClass:"state-box"})])]),i._v(" "),e("div",{staticClass:"state-bottom"},[e("div",{staticClass:"vipCar"},[e("ul",[e("li",[i._v("VIP车位")]),i._v(" "),e("li",i._l(i.vipCarList,function(t){return e("span",{key:t.carpos_gid},[i._v("\n              "+i._s(t.carpos_name)+"\n            ")])}))])]),i._v(" "),e("transition",{attrs:{name:"el-zoom-in-top"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:i.carInfoShow,expression:"carInfoShow"}],staticClass:"vipCarInfo"},[e("ul",[e("li",[i._v("车位信息")]),i._v(" "),e("li",{directives:[{name:"show",rawName:"v-show",value:!i.addModel,expression:"!addModel"}]},[e("el-button",{directives:[{name:"show",rawName:"v-show",value:i.edit,expression:"edit"}],attrs:{type:"primary",size:"small"},on:{click:function(t){i.startEdit()}}},[i._v("编辑")]),i._v(" "),e("el-button",{directives:[{name:"show",rawName:"v-show",value:i.editModel,expression:"editModel"}],attrs:{type:"danger",size:"small"},on:{click:function(t){i.canaleEdit()}}},[i._v("结束编辑")]),i._v(" "),e("el-button",{directives:[{name:"show",rawName:"v-show",value:i.editModel,expression:"editModel"}],attrs:{type:"primary",size:"small"},on:{click:function(t){i.delVisible=!0}}},[i._v("删除车位")])],1),i._v(" "),e("li",[i._v("\n            车位号 : "+i._s(i.VipCarInfo.carNum)+"  \n            分区号 : "+i._s(i.VipCarInfo.carArea)+"\n          ")]),i._v(" "),e("li",[i._v("\n            车牌号:\n            "),i._l(i.vipCar_numbers,function(t,o){return e("span",{key:o},[i._v("\n              "+i._s(t)+"  "),e("i",{staticClass:"el-icon-error",on:{click:function(e){i.deleteCarNumsList(i.vipCar_numbers,t,o)}}})])})],2),i._v(" "),e("transition",{attrs:{name:"el-zoom-in-top"}},[e("li",{directives:[{name:"show",rawName:"v-show",value:i.carNumShow,expression:"carNumShow"}]},[i._v("\n              添加车牌号:  \n              "),e("el-input",{staticClass:"elInput",attrs:{placeholder:"请输入内容",size:"mini","auto-complete":"",maxlength:"8",minlength:"1"},model:{value:i.inputCarnum,callback:function(t){i.inputCarnum=t},expression:"inputCarnum"}}),i._v(" "),e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){i.addCarnums()}}},[i._v("  添加  ")])],1)]),i._v(" "),e("transition",{attrs:{name:"el-zoom-in-top"}},[e("li",{directives:[{name:"show",rawName:"v-show",value:i.submitShow,expression:"submitShow"}]},[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){i.submit()}}},[i._v("  提交  ")])],1)])],1)])])],1)]),i._v(" "),e("div",{staticClass:"state-tor",attrs:{id:"mapDiv"}},[e("div",{ref:"mybox",staticClass:"the-map",attrs:{id:"map"}}),i._v(" "),e("div",{staticClass:"button"},[e("el-button",{directives:[{name:"show",rawName:"v-show",value:!i.addModel,expression:"!addModel"}],attrs:{type:"primary",round:"",size:"medium"},on:{click:function(t){i.addVipCarModel()}}},[i._v("添加VIP车位")]),i._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:i.addModel,expression:"addModel"}],staticClass:"buttonSon"},[e("div",{staticClass:"sonbt"},[e("el-button",{attrs:{type:"danger",round:"",size:"medium"},on:{click:function(t){i.canaleVipCarModel()}}},[i._v("取消添加")])],1)])],1),i._v(" "),e("img",{staticClass:"up",attrs:{src:o("6BN9"),alt:"up"},on:{click:function(t){i.upFloor()}}}),i._v(" "),e("div",{attrs:{id:"floor"}},[e("ul",{ref:"floorUl",attrs:{id:"floorUl"}})]),i._v(" "),e("img",{staticClass:"down",attrs:{src:o("WIY8"),alt:"down"},on:{click:function(t){i.downFloor()}}})]),i._v(" "),e("el-dialog",{staticClass:"imgSrcDialog",attrs:{title:"查看图片","append-to-body":!0,"lock-scroll":!0,modal:!0,"close-on-click-modal":!1,visible:i.mapVehicle,top:"35vh",width:"30%"},on:{"update:visible":function(t){i.mapVehicle=t},close:i.mapDialog}},[e("div",{staticClass:"map-img"},[e("img",{attrs:{src:i.carNumberSrc}})])]),i._v(" "),e("el-dialog",{attrs:{title:"是否提交",visible:i.submitVisible,"lock-scroll":!0,top:"30vh",width:"26%","append-to-body":!0},on:{"update:visible":function(t){i.submitVisible=t}}},[e("span",[i._v("确认要提交车位信息吗?")]),i._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(t){i.submitVisible=!1}}},[i._v("取 消")]),i._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:function(t){i.confirmSubmit()}}},[i._v("确 定")])],1)]),i._v(" "),e("el-dialog",{attrs:{title:"是否删除车位",visible:i.delVisible,"lock-scroll":!0,top:"30vh",width:"26%","append-to-body":!0},on:{"update:visible":function(t){i.delVisible=t}}},[e("span",[i._v("确认要删除该车位吗?")]),i._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(t){i.delVisible=!1}}},[i._v("取 消")]),i._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:function(t){i.confirmDel()}}},[i._v("确 定")])],1)])],1)},staticRenderFns:[]};var p=o("vSla")(l,d,!1,function(i){o("/xvr")},"data-v-09a71d47",null);t.default=p.exports}});
//# sourceMappingURL=20.3683a7295e8d42d4a06f.js.map