webpackJsonp([5],{"6SEl":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OTU0QjE4N0E0MUU3MTFFOEFFOTVFQzhGOEM5NEEyRjEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OTU0QjE4N0I0MUU3MTFFOEFFOTVFQzhGOEM5NEEyRjEiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5NTRCMTg3ODQxRTcxMUU4QUU5NUVDOEY4Qzk0QTJGMSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5NTRCMTg3OTQxRTcxMUU4QUU5NUVDOEY4Qzk0QTJGMSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PrcZIokAAAF/SURBVHjarNRNKARhHMfxXUscRHFw8RJpKUTJQUpxEOvCSe2FgwvtRTk7ODtQLpSj4iIHoU0cyWsKtcSBXIQDibx/n/qNpml2jbX/+hx2Z+b3PM//eWb8w333vlRW+i/X01CCICokKAGMYtotMF83VdoeMA+XIzPBgBPYwJk90PzYRQy16PrDCrMUGrIv6VWzeUMP1j0EfeAcKzjVCn9mGFZIvcIn0arrt5p5TA9e6B7Tv1K1Zg139sBDtKNT/4U18jaubf1sQhkyHLN9xpJzU3YwhGI8YAQnHvtY4zwWVh2jWstfxKfHwMd45/AIVRhDno7QYIIgM+As+uMFbiICv86WWfYVttCIQt03hXnsqT1WFaDBHniDNh0d08s6bYqpZQW+YEEDWpWtfhe5vXpfmHNZXkjXxhF1XAtYYc5N8VLNepNyk/042KtbZpCjoxZV733JzNAcpV41vwP72uHVZAOtetfrFlHvWv4b6NzEg1QGun6R/1tPGNBbc/ktwABDX1DGL+ocXgAAAABJRU5ErkJggg=="},"Uz+2":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=a("yB3Q"),n=a("uVkj"),l={name:"video-demand",data:function(){var e=this;return{value1:"",mapVisible:!1,mapShow:!0,choseDateValue:"",videoDateValue:[],demand:!0,demandMap:"",featureDemand:"",sPeerID:"",oldsPeerID:"",sClientAddr:"",sClientVideoAddr:"",cameraResult:"",cameraPostDate:"",videoList:[],loading:!1,deviceId:"",ce:!0,map:"",choseDateOptions:{disabledDate:function(t){if(e.videoDateValue.length>=1)return t.getTime()<new Date(e.videoDateValue[0].date).getTime()||t.getTime()>new Date(e.videoDateValue[e.videoDateValue.length-1].date).getTime()}},playerDemandOptions:{overNative:!0,autoplay:!1,controls:!0,techOrder:["html5","flash"],sourceOrder:!0,preload:"auto",aspectRatio:"16:9",flash:{hls:{withCredentials:!1},swf:"/static/media/video-js.swf"},html5:{hls:{withCredentials:!1}},sources:[{type:"application/x-mpegURL",src:""},{withCredentials:!1,type:"application/x-mpegURL",src:""}],poster:"/static/img/video/camera.png",notSupportedMessage:"此视频暂无法播放，请稍后再试",height:"350"}}},mounted:function(){var e=this,t=new i.a.BeefindMap({target:e.$refs.myMap,floorUl:e.$refs.floorUl,city_id:this.$CityId,build_id:this.$BuildId,urlLocal:this.$Api,floor_id:"",floorBarVisible:!0,carLayerVisible:!0,carPortLayerVisible:!0,interLayerVisible:!0,deviceLayerVisible:!0});e.map=t;e.map.on("click",function(t){var a=e.map.forEachFeatureAtPixel(t.pixel,function(e){return e});if(a&&("3"==localStorage.getItem("clickMap")&&"camera"==a.type)){e.featureDemand=a;var i=void 0,l=void 0;i=a.param.fmn>=1e4?a.param.fmn:a.param.fmn>=1e3?"0"+a.param.fmn:a.param.fmn>=100?"00"+a.param.fmn:a.param.fmn>=10?"000"+a.param.fmn:"0000"+a.param.fmn,l=a.param.rannum>=100?a.param.rannum:a.param.rannum>=10?"0"+a.param.rannum:"00"+a.param.rannum;var o=e.$BuildId.substring(0,1).toLocaleUpperCase()+e.$BuildId.substring(1)+l+i;e.sClientAddr="127.0.0.1:12351",e.sPeerID=o,s=localStorage.getItem("demandSPeerId"),console.log(s),e.loading=!0,e.device_id=a.param.fmn,e.videoDateValue=[],e.videoList=[],e.choseDateValue="",e.playerDemandOptions.sources[0].src="",e.playerDemandOptions.autoplay=!1,n.a.pgConnectDelete(s,0,0,"127.0.0.1:8421","127.0.0.1:12351",e.delete)}}),localStorage.setItem("clickMap","3")},beforeDestroy:function(){this.map.removeEventListener("singleclick");var e=localStorage.getItem("demandSPeerId");n.a.pgConnectDelete(e,0,0,"127.0.0.1:8421","127.0.0.1:12351",this.deleteDm),n.a.pgConnectDelete(e,0,0,"127.0.0.1:80","127.0.0.1:2018",this.deleteDm),this.playerDemandOptions.sources[0].src="",this.playerDemandOptions.autoplay=!1},methods:{handleApply:function(){this.playerOptions.sources[0].src=this.url},dialog:function(e,t){this.dialogVisible=!0},dialogDemandHide:function(){this.mapVisible=!1,this.map.target(null)},imgDemandMap:function(){this.mapVisible=!0;var e=this;e.map.target(null),setTimeout(function(){e.mapVisible&&e.map.target(e.$refs.myMap)},100)},changePicker:function(){console.log("changePicker"),console.log(this.cameraResult.result),1!=this.cameraResult.result&&(this.open3(),this.choseDateValue=""),null==this.choseDateValue?(this.videoList=[],this.videoDateValue=[],this.cameraResult.result=0,this.playerDemandOptions.sources[0].src="",this.playerDemandOptions.autoplay=!1):(this.videoList=[],this.playerDemandOptions.sources[0].src="",this.playerDemandOptions.autoplay=!1)},getVideoList:function(){if(0!=this.videoDateValue.length)if(""!=this.choseDateValue&&void 0!=this.choseDateValue&&null!=this.choseDateValue){this.loading=!0;for(var e,t,a=[{date:this.choseDateValue}],s=this.changeDateFormat(a,a.length),i=0;i<this.videoDateValue.length;i++){if(this.videoDateValue[i].date==s[0].date){e=this.videoDateValue[i].type;break}e="camera"}t="local"==e?this.$localVideo+"/getVideoList":this.cameraPostDate.cameraUrl+"/getVideoList",console.log(t);var n={build_id:this.cameraPostDate.build_id,area_id:this.cameraPostDate.area_id,dev_id:this.cameraPostDate.dev_id,date:this.choseDateValue};this.playerDemandOptions.sources[0].src="",this.playerDemandOptions.autoplay=!1,this.vuePost(n,t,e)}else this.open1();else this.open3()},changeDateFormat:function(e,t){for(var a=0;a<t;a++){var s=e[a].date.substr(0,4),i=e[a].date.substr(4,2);i=parseFloat(i)>=10?i:i.substr(1,1);var n=e[a].date.substr(6,2),l=s+"/"+i+"/"+(n=parseFloat(n)>=10?n:n.substr(1,1));e[a].date=l}return e},combineCameraDate:function(e,t){for(var a=0;a<t.length;a++){var s=t[a];t[a]=new Object,t[a].date=s,t[a].type=e}return t},open1:function(){this.$message({message:"请选择视频播放日期!",type:"success",center:!0})},open2:function(){this.$message({message:"对不起,当天没有视频!",type:"warning",center:!0})},open3:function(){this.$message({message:"请选择设备!",type:"warning",center:!0})},open4:function(){this.$message({message:"当前设备没有视频源!",type:"warning",center:!0})},warnP2p:function(){this.$message({message:"p2p连接失败!",type:"warning",center:!0})},upFloor:function(){i.a.upFloor(function(e){})},warnMessage:function(e){this.$message({message:e,type:"warning",center:!0})},downFloor:function(){i.a.downFloor(function(e){})},vuePost:function(e,t,a){var s=this,i=this,n=e,l=new URLSearchParams;l.append("build_id",n.build_id),l.append("area_id",n.area_id),l.append("dev_id",n.dev_id),l.append("date",n.date),this.$http.post(t,l,{dataType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){console.log(e),"0"==e.data.result?i.warnMessage("当天的摄像头无视频源,请选择其它日期!"):(i.videoList=e.data.video_list,i.addAttribute(i.videoList,a)),i.loading=!1}).catch(function(e){i.loading=!1,s.$notify({title:"ERROR",message:""+e,duration:2e3,type:"error"})})},handlePlay:function(e,t){this.playerDemandOptions.sources[0].src=t.url,this.playerDemandOptions.autoplay=!0},playErr:function(e){console.log(e)},handleDownload:function(e,t){},formatDate:function(e,t){var a=e.getFullYear(),s=e.getMonth()+1,i=e.getDate(),n=e.getHours(),l=e.getMinutes(),o=e.getSeconds();return"hour"!=t?"onlyHour"==t?n:"ymd"==t?a+"/"+s+"/"+i:a+"/"+s+"/"+i+"/"+n+":"+l+":"+o:0==l?o+"秒":l<=60?+l+"分"+o+"秒":void 0},addAttribute:function(e,t){for(var a=0;a<e.length;a++){var s=parseInt(e[a].start)+parseInt(1514736e6),i=parseInt(e[a].start)+parseInt(1514736e6),n=parseInt(e[a].end)+parseInt(1514736e6);e[a].videoTime=this.formatDate(new Date(n-i),"hour"),e[a].index=a,e[a].time=this.formatDate(new Date(s),"onlyHour"),e[a].showStart=this.formatDate(new Date(i),"fullYear"),e[a].showEnd=this.formatDate(new Date(n),"fullYear"),e[a].url="camera"==t?this.cameraPostDate.demandVideoUrl+"/live/"+this.choseDateValue+"/"+e[a].time+"/"+e[a].start+".m3u8":this.$lookVideo+this.device_id+"/"+this.choseDateValue+"/"+e[a].time+"/"+e[a].start+".m3u8"}},back:function(e,t){t=JSON.parse(t);this.dialogDemandHide();if(this.sClientVideoAddr="127.0.0.1:2018","0"==t.result){this.tunnel=!0;var a,l="http://"+t.clientaddr,o=this.$localVideo,r=void 0,d=[],c=i.a.getCameraDate(l,this.featureDemand.build_id,this.featureDemand.param.rannum,this.featureDemand.param.fmn),u=i.a.getCameraDate(o,this.featureDemand.build_id,this.featureDemand.param.rannum,this.featureDemand.param.fmn);if(d=0==u.result?[]:u,d=this.combineCameraDate("local",d),"0"==c.result?(this.open4(),this.videoDateValue=[],this.loading=!1):(n.a.pgConnectDelete(s,0,0,"127.0.0.1:80","127.0.0.1:2018",this.deleteVideo),this.cameraResult=c,r=this.combineCameraDate("camera",c.date_list),this.open1(),this.loading=!1),(a=d.concat(r)).length>=1){var p={demandVideoUrl:"",cameraUrl:l,build_id:this.featureDemand.build_id,area_id:this.featureDemand.param.rannum,dev_id:this.featureDemand.param.fmn};this.cameraPostDate=p,this.videoDateValue=a,this.videoDateValue=this.changeDateFormat(this.videoDateValue,this.videoDateValue.length),this.open1(),this.loading=!1}}else this.warnP2p(),this.loading=!1},backVideo:function(e,t){t=JSON.parse(t);console.log(t),"0"==t.result?this.cameraPostDate.demandVideoUrl="http://"+t.clientaddr:this.open1()},deleteDm:function(e,t){},delete:function(e,t){var a=t.substring(3);"18"!=(a=JSON.parse(a)).result&&"0"!=a.result||n.a.pgConnectAdd(this.sPeerID,0,0,"127.0.0.1:8421",this.sClientAddr,this.back),this.dialogDemandHide()},deleteVideo:function(e,t){var a=t.substring(3);a=JSON.parse(a);n.a.pgConnectAdd(this.sPeerID,0,0,"127.0.0.1:80",this.sClientVideoAddr,this.backVideo),localStorage.setItem("demandSPeerId",this.sPeerID)}}},o={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"par-state main-padding"},[s("el-row",{attrs:{gutter:10}},[s("el-col",{staticClass:"col-one",attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[s("div",{staticClass:"block"},[s("el-date-picker",{attrs:{type:"date",format:"yyyy年MM月dd日","value-format":"yyyyMMdd","picker-options":e.choseDateOptions,placeholder:"选择日期"},on:{change:e.changePicker},model:{value:e.choseDateValue,callback:function(t){e.choseDateValue=t},expression:"choseDateValue"}}),e._v(" "),s("el-button",{on:{click:e.getVideoList}},[e._v("视频列表")])],1)]),e._v(" "),s("el-col",{staticClass:"col-two",attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[s("div",{staticClass:"grid-content bg-purple",attrs:{id:"vOne"},on:{click:function(t){t.preventDefault(),e.dialog("vOne",t)}}},[s("video-player",{ref:"videoPlayer",staticClass:"vjs-custom-skin",attrs:{options:e.playerDemandOptions},on:{err:function(t){e.playErr(t)}}}),e._v(" "),s("img",{staticClass:"videoIcon",attrs:{src:a("6SEl"),alt:""},on:{click:function(t){if(t.target!==t.currentTarget)return null;e.imgDemandMap()}}})],1)]),e._v(" "),s("el-col",{staticClass:"col-three",attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[s("el-table",{staticStyle:{width:"100%","overflow-y":"auto"},attrs:{data:e.videoList,height:"300"}},[s("el-table-column",{staticStyle:{width:"25%"},attrs:{label:"视频顺序"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("i",{staticClass:"el-icon-time"}),e._v(" "),s("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.row.index+1))])]}}])}),e._v(" "),s("el-table-column",{staticStyle:{width:"35%"},attrs:{label:"视频开始时间/结束时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[e._v("\n                "+e._s(t.row.showStart)+"~"+e._s(t.row.showEnd)+"\n              ")])]}}])}),e._v(" "),s("el-table-column",{staticStyle:{width:"20%"},attrs:{label:"视频时长"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[e._v("\n                "+e._s(t.row.videoTime)+"\n              ")])]}}])}),e._v(" "),s("el-table-column",{staticStyle:{width:"20%","text-align":"center"},attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini"},on:{click:function(a){e.handlePlay(t.$index,t.row)}}},[e._v("播放")])]}}])})],1)],1)],1),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.mapVisible,expression:"mapVisible"}],staticClass:"demandDialog"},[s("div",{staticClass:"demandDialogInfo",attrs:{xs:24,sm:12,md:12,lg:12,xl:12,offset:6}},[s("ul",[s("li",[s("ul",[s("li",[e._v(" 请选择视频点播的设备")]),e._v(" "),s("li",[s("i",{staticClass:"el-icon-error",on:{click:function(t){t.stopPropagation(),e.dialogDemandHide()}}})])])]),e._v(" "),s("li",[s("div",{directives:[{name:"show",rawName:"v-show",value:e.mapShow,expression:"mapShow"}],ref:"myMap",attrs:{id:"demandMap"}}),e._v(" "),s("img",{staticClass:"up",attrs:{src:a("6BN9"),alt:"up"},on:{click:function(t){e.upFloor()}}}),e._v(" "),s("div",{attrs:{id:"floor"}},[s("ul",{ref:"floorUl",attrs:{id:"floorUl"}})]),e._v(" "),s("img",{staticClass:"down",attrs:{src:a("WIY8"),alt:"down"},on:{click:function(t){e.downFloor()}}})])])])])],1)},staticRenderFns:[]};var r=a("Z0/y")(l,o,!1,function(e){a("fln8")},"data-v-4fc28ea5",null);t.default=r.exports},fln8:function(e,t){},uVkj:function(module,__webpack_exports__,__webpack_require__){"use strict";var g_back;const tunnel={pgConnectAdd(e,t,a,s,i,n){pgTunnelRequest("127.0.0.1:17881","GET","cnntadd?peerid="+e+"&type="+t+"&encrypt="+a+"&listenaddr="+s+"&clientaddr="+i,"",tunnel.pgTunnelCallback),g_back=n},pgConnectDelete(e,t,a,s,i,n){pgTunnelRequest("127.0.0.1:17881","GET","cnntdelete?peerid="+e+"&type="+t+"&encrypt="+a+"&listenaddr="+s+"&clientaddr="+i,"",tunnel.pgTunnelCallback),g_back=n},pgConnectQuery(e,t){pgTunnelRequest("127.0.0.1:17881","GET","cnntlclquery?clientaddr="+e,"",tunnel.pgTunnelCallback),g_back=t},pgTunnelCallback(uStatus,sResp){if("function"==typeof g_back){let e;e=sResp.substring(8),g_back(uStatus,e)}else console.log("not func");if(200==uStatus){var iInd=sResp.indexOf(":");if(!(iInd<=0)){var sMeth=sResp.substring(0,iInd),oResp=eval("("+sResp.substring(iInd+1)+")");"domainget"==sMeth?oResp.domain:"domainset"==sMeth?void 0!==oResp.result&&("0"!=oResp.result?"2"==oResp.result?alert("输入的识别码错误"):"18"==oResp.result?alert("输入的识别码不存在"):"19"==oResp.result?alert("该识别码所在域的客户端数量已经达到上限，请升级域的级别！"):"10"==oResp.result?alert("尚未登录"):alert("设置识别码失败，错误码="+oResp.result):(pgCommentSet(id_comment.value),alert("设置识别码成功"))):"commentget"==sMeth?void 0!==oResp.comment&&(id_comment.value=oResp.comment):"commentset"==sMeth?void 0!==oResp.result&&"0"!=oResp.result&&(pgCommentGet(),"2"==oResp.result?alert("参数无效"):alert("修改说明失败，错误码="+oResp.result)):"remoteinvite"==sMeth?void 0!==oResp.result&&("0"==oResp.result?alert("发送请求成功"):"17"==oResp.result?alert("当前已经在远程协助状态"):"2"==oResp.result?alert("参数错误"):"10"==oResp.result?alert("尚未登录"):"18"==oResp.result?alert("没有指定客服人员"):"6"==oResp.result?alert("客服人员不在线"):alert("发送请求失败，错误码="+oResp.result)):"capturectrl"==sMeth?void 0!==oResp.result&&("0"!=oResp.result?alert("触发抓屏失败，错误码="+oResp.result):alert("触发抓屏成功")):"tunnelset"==sMeth&&void 0!==oResp.result&&("0"!=oResp.result?"2"==oResp.result?alert("输入的识别码错误"):"18"==oResp.result?alert("输入的识别码不存在"):"19"==oResp.result?alert("该识别码所在域的客户端数量已经达到上限，请升级域的级别！"):"10"==oResp.result?alert("尚未登录"):alert("设置失败，错误码="+oResp.result):alert("设置成功"))}}}};__webpack_exports__.a=tunnel}});
//# sourceMappingURL=5.418855b7be23b73e038b.js.map