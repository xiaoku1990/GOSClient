webpackJsonp([16],{Hdgg:function(e,r){},jzkS:function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=a("3cXf"),s=a.n(t),o=a("a3Yh"),i=a.n(o),n=a("yB3Q"),c={name:"parking-state",components:{},data:function(){return{stateMsg:!0,mapVehicle:!1,changeColor:"#cccccc",featureDate:"",carNumberSrc:"",popupLayer:"",collapseShow:!1,parkMap:"",floorName:"",floorId:"",userInfo:"",stateData:[],choseScreenId:"",screenList:[],controlCarList:[],screenControlCar:[{index:"1",carpos_list:[{carpos_name:"21",carpos_gid:"LX02421",carpos_areaID:"4"},{carpos_name:"26",carpos_gid:"LX02426",carpos_areaID:"4"},{carpos_name:"07",carpos_gid:"LX02407",carpos_areaID:"4"},{carpos_name:"13",carpos_gid:"LX02513",carpos_areaID:"5"},{carpos_name:"05",carpos_gid:"LX02505",carpos_areaID:"5"}]},{index:"2",carpos_list:[{carpos_name:"39",carpos_gid:"LX02539",carpos_areaID:"5"},{carpos_name:"54",carpos_gid:"LX02554",carpos_areaID:"5"},{carpos_name:"06",carpos_gid:"LX02506",carpos_areaID:"5"},{carpos_name:"43",carpos_gid:"LX02543",carpos_areaID:"5"},{carpos_name:"56",carpos_gid:"LX02556",carpos_areaID:"5"},{carpos_name:"66",carpos_gid:"LX02566",carpos_areaID:"5"},{carpos_name:"47",carpos_gid:"LX02547",carpos_areaID:"5"},{carpos_name:"55",carpos_gid:"LX02555",carpos_areaID:"5"}]},{index:"3",carpos_list:[{carpos_name:"34",carpos_gid:"LX02434",carpos_areaID:"4"},{carpos_name:"32",carpos_gid:"LX02432",carpos_areaID:"4"},{carpos_name:"05",carpos_gid:"LX02505",carpos_areaID:"5"}]}],batchAdd:!0,addScreenCarArr:[],clickedValIn:"",choseIn:!1}},created:function(){var e=localStorage.getItem("userInfo");this.userInfo=JSON.parse(e)},mounted:function(){var e=this;this.pushTaggle="true"===localStorage.getItem("messagePush");var r=new n.a.BeefindMap(i()({target:this.$refs.mybox,floorUl:this.$refs.floorUl,mapType:"screenControl",urlLocal:this.$Api,city_id:this.$CityId,build_id:this.$BuildId,floor_id:"",floorBarVisible:!0,carLayerVisible:!0,carPortLayerVisible:!0,interLayerVisible:!0,deviceLayerVisible:!1},"deviceLayerVisible",!1));e.parkMap=r,e.floorId=r.floorId;var a=new ol.Overlay({element:e.$refs.popup,positioning:"top-center",stopEvent:!0,offset:[0,-25]});e.popupLayer=a,e.parkMap.addOverlay(e.popupLayer),e.parkMap.on("singleclick",function(r){var a=e.parkMap.forEachFeatureAtPixel(r.pixel,function(e){return e});if(console.log(a),a)if(e.featureDate=a,"car"==a.type||"carEvent"==a.type)if(e.choseIn)if(e.batchAdd)if(a.choseCar){console.log("为控制车位!");var t=a.carposPoint;e.popupLayer.setPosition(t)}else e.warn("请开启添加按钮!");else a.choseCar?e.warn("该车位已添加,请选择其他车位!"):("car"==a.type?a.setCarColor("#7460ee"):(a=n.a.findCarFeature(a)).setCarColor("#7460ee"),e.filterFeature(a));else e.warn("请选择你要添加的引导屏以及方位!");else e.warn("请点击你要添加的车位!")}),e.initParkInfo(e.parkMap.floor,e.parkMap.carpos_sum),n.a.addScreen(null),e.getSlist()},beforeDestroy:function(){this.parkMap.removeEventListener("singleclick"),n.a.clearStateInter(),this.parkMap="",this.popupLayer.setPosition(void 0),n.a.addScreen(null)},methods:{mapImg:function(){this.mapVehicle=!0},mapDialog:function(){this.mapVehicle=!1},initParkInfo:function(e,r){this.floorName=e},stateClose:function(){},stateClick:function(){},upFloor:function(){var e=this,r=this.$Api+"/GOSSystem/ScreenList",a="beefind001";n.a.upFloor(function(t,s){e.floorName=t,e.floorId=s,e.initParkInfo(e.parkMap.floor,e.parkMap.carpos_sum),e.getScreenList(r,e.$BuildId,e.floorId,a)}),n.a.addScreen(null)},downFloor:function(){var e=this,r=this.$Api+"/GOSSystem/ScreenList",a="beefind001";n.a.downFloor(function(t,s){e.floorName=t,e.floorId=s,e.initParkInfo(e.parkMap.floor,e.parkMap.carpos_sum),e.getScreenList(r,e.$BuildId,e.floorId,a)}),n.a.addScreen(null)},openDialog:function(){this.dialogVisible=!0},carNumberImg:function(){var e=this,r=e.$Api+this.featureDate.car_picUrl.substring(25);console.log(r),e.carNumberSrc="",setTimeout(function(){e.carNumberSrc=r,e.popupLayer.setPosition(null),e.mapVehicle=!0},150)},warn:function(e){this.$message({message:e,type:"warning",center:!0})},specialWarn:function(){this.$message({message:"该车为特殊车辆!无权限查看!",type:"warning",center:!0})},featureWarn:function(){this.$message({message:"查看车牌请点击车位!",type:"warning",center:!0})},hideOverLayer:function(){this.featureDate="",this.popupLayer.setPosition(void 0)},getScreenList:function(e,r,a,t){var s=this,o=new URLSearchParams;o.append("build_id",r),o.append("floor_id",a),o.append("user_id","beefind001"),this.$http.post(e,o,{timeout:3e3,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){console.log(e),"1"==e.data.result?e.data.screen_list.length>=1?(s.collapseShow=!1,s.screenList=[],s.screenList=e.data.screen_list):s.warn("引导屏列表为空"):(s.screenList=[],s.collapseShow=!0,s.warn("获取屏幕列表失败!"))}).catch(function(e){s.$notify({title:"ERROR",message:""+e,duration:2e3,type:"error"})})},filterControlCarList:function(e){var r=e;return console.log(r),r.length>=1&&r.forEach(function(e){"1"==e.index?(e.message="1",e.carColor="#ffc6ee"):"2"==e.index?(e.message="2",e.carColor="#cfc9ff"):(e.message="3",e.carColor="#84e246")}),r},getControlCarList:function(e,r){var a=this,t=new URLSearchParams;t.append("build_id",r.build_id),t.append("floor_id",r.floor_id),t.append("user_id",r.user_id),t.append("screen_id",r.screen_id),this.$http.post(e,t,{timeout:3e3,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){console.log(e),"1"==e.data.result?(a.controlCarList=a.filterControlCarList(e.data.index_list),n.a.resetCarColor("#969696")):a.warn("获取屏幕控制车位列表失败!")}).catch(function(e){a.$notify({title:"ERROR",message:""+e,duration:3e3,type:"error"})})},addScreenCarControl:function(e,r){var a=this,t=(r=r,new URLSearchParams),o=this.$Api+"/GOSSystem/screenCarposList",i={user_id:"beefind001",build_id:this.$BuildId,floor_id:this.floorId,screen_id:this.choseScreenId};for(var c in r)t.append(c,s()(r[c]));this.$http.post(e,t,{timeout:3e3,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){if("1"==e.data.result){a.batchAdd=!a.batchAdd,a.getControlCarList(o,i);var t=a.controlCarList.filter(function(e){return e.index==r.index});a.clickedValIn="",a.choseIn=!1,n.a.screenCarColor(t,t.carColor)}else a.warn("添加车位到引导屏失败!")}).catch(function(e){a.$notify({title:"ERROR",message:""+e,duration:3e3,type:"error"})})},deleteScreenCarControl:function(e,r){var a=this,t=new URLSearchParams,o=this.$Api+"/GOSSystem/screenCarposList",i={user_id:"beefind001",build_id:this.$BuildId,floor_id:this.floorId,screen_id:this.choseScreenId};for(var n in r)t.append(n,s()(r[n]));this.$http.post(e,t,{timeout:2e3,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){if(console.log(e),"1"==e.data.result){a.clickedValIn="",a.choseIn=!1,a.getControlCarList(o,i);a.controlCarList.filter(function(e){return e.index==r.index});a.featureDate.setCarColor("#969696")}else a.warn("删除车位到引导屏失败!")}).catch(function(e){a.$notify({title:"ERROR",message:""+e,duration:3e3,type:"error"})})},showCarList:function(e){var r=void 0,a=void 0,t=void 0;e&&(a=(r=JSON.parse(e)).screen_id,this.choseScreenId=r.screen_id,t={user_id:"beefind001",build_id:this.$BuildId,floor_id:this.floorId,screen_id:a});var s=this.$Api+"/GOSSystem/screenCarposList";a?(this.getControlCarList(s,t),n.a.addScreen(r)):(console.log("else"),n.a.resetCarColor("#969696"),n.a.addScreen(null))},choseIndex:function(e){console.log(e),console.log(this.$refs)},choseScreen:function(e){this.addScreenCarArr=[],console.log(e),this.choseIn=!0,this.clickedValIn=e.index,n.a.screenCarColor(e,e.carColor)},filterPost:function(e){var r={user_id:"beefind001"};return r.build_id=e[0].build_id,r.floor_id=e[0].floor_id,r.screen_id=this.choseScreenId,r.index=e[0].index,r.add_carpos=[],console.log(e),e.forEach(function(e){var a={};a.carpos_name=e.carNum,a.carpos_gid=e.carUID,a.carpos_areaID=e.carArea,r.add_carpos.push(a)}),r},filterDeletePost:function(e){var r={user_id:"beefind001"};r.build_id=e.build_id,r.floor_id=e.floor_id,r.screen_id=this.choseScreenId,r.index=e.index,r.delete_carpos=[];var a={};return a.carpos_name=e.carNum,a.carpos_gid=e.carUID,a.carpos_areaID=e.carArea,r.delete_carpos.push(a),r},addScreenCar:function(){var e=void 0,r=this.$Api+"/GOSSystem/addCarposToScreen";this.addScreenCarArr.length>=1?(e=this.filterPost(this.addScreenCarArr),this.addScreenCarControl(r,e)):this.warn("请选择所要添加的车位!")},cancelAdd:function(){this.batchAdd=!this.batchAdd,alert(this.addScreenCarArr),this.addScreenCarArr.forEach(function(e,r,a){e.setCarColor("#969696")}),this.addScreenCarArr=[]},getSlist:function(){var e=localStorage.getItem("userInfo");this.userInfo=JSON.parse(e);var r=this.$Api+"/GOSSystem/ScreenList";console.log(r);var a=this.userInfo.user_id;null!=this.floorId&&void 0!=this.floorId&&""!=this.floorId&&this.floorId;console.log(this.floorId),this.getScreenList(r,this.$BuildId,this.floorId,a)},filterFeature:function(e){var r=e,a=this.addScreenCarArr;console.log(a),this.addScreenCarArr.length<=0?this.addScreenCarArr.push(r):this.addScreenCarArr.some(function(e){return e==r})?(this.addScreenCarArr.pop(r),r.setCarColor("#969696")):this.addScreenCarArr.push(r)},deleteCar:function(){this.popupLayer.setPosition(void 0);var e=this.filterDeletePost(this.featureDate),r=this.$Api+"/GOSSystem/deleteCarposFromScreen";console.log(e),this.deleteScreenCarControl(r,e)}}},l={render:function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"par-state main-padding"},[t("div",{staticClass:"state-one"},[t("div",{staticClass:"state-top"},[t("div",{staticClass:"state-round"},[e._v(e._s(e.floorName)),t("div",{staticClass:"state-box"})])]),e._v(" "),t("div",{staticClass:"state-bottom"},[t("div",{staticClass:"collapse",staticStyle:{"text-align":"center"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.collapseShow,expression:"collapseShow"}],staticClass:"collapseShow"},[e._v("无引导屏列表数据")]),e._v(" "),t("el-collapse",{attrs:{accordion:""},on:{change:e.showCarList}},e._l(e.screenList,function(r,a){return t("el-collapse-item",{key:r.screen_id,staticClass:"screenList",attrs:{value:"item",name:JSON.stringify(r)}},[t("template",{slot:"title"},[t("div",{staticStyle:{"background-color":"#efefef","font-family":"'Microsoft YaHei UI'","font-size":"14px",border:"1px solid #d3d3d3"}},[e._v("\n                 引导屏ID: "+e._s(r.screen_id)+"\n               ")])]),e._v(" "),t("div",{staticClass:"carScreenList"},e._l(e.controlCarList,function(r){return t("div",{key:r.index,staticClass:"carScreenListItem",on:{click:function(a){e.choseIndex(r)}}},[t("div",{staticClass:"screenIndex",class:{clickColor:e.clickedValIn===r.index},style:{lineHeight:"100%"},on:{click:function(a){e.choseScreen(r)}}},[t("div",{staticClass:"screenIndexSon"},[e._v("\n                      "+e._s(r.message)+"\n                    ")])]),e._v(" "),t("div",{staticClass:"screenCar"},e._l(r.carpos_list,function(a){return t("span",{key:a.index,staticClass:"spanCar",style:{background:r.carColor+""}},[e._v("\n                         "+e._s(a.carpos_name)+"\n                     ")])}))])}))],2)}))],1)])]),e._v(" "),t("div",{staticClass:"state-tor",attrs:{id:"mapDiv"}},[t("div",{ref:"mybox",staticClass:"the-map",attrs:{id:"map"}}),e._v(" "),t("div",{staticClass:"button"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.batchAdd,expression:"batchAdd"}],attrs:{type:"primary",round:"",size:"medium"},on:{click:function(r){e.batchAdd=!e.batchAdd}}},[e._v("批量添加")]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.batchAdd,expression:"!batchAdd"}],staticClass:"buttonSon"},[t("div",{staticClass:"sonbt"},[t("el-button",{attrs:{type:"danger",round:"",size:"medium"},on:{click:e.cancelAdd}},[e._v("取消添加")])],1),e._v(" "),t("div",{staticClass:"sonbt"},[t("el-button",{attrs:{type:"primary",round:"",size:"medium"},on:{click:e.addScreenCar}},[e._v("确认添加")])],1)])],1),e._v(" "),t("img",{staticClass:"up",attrs:{src:a("6BN9"),alt:"up"},on:{click:function(r){e.upFloor()}}}),e._v(" "),t("div",{attrs:{id:"floor"}},[t("ul",{ref:"floorUl",attrs:{id:"floorUl"}})]),e._v(" "),t("img",{staticClass:"down",attrs:{src:a("WIY8"),alt:"down"},on:{click:function(r){e.downFloor()}}}),e._v(" "),t("div",{ref:"popup",staticClass:"ol-popup",attrs:{id:"popup"}},[t("div",{staticClass:"popDiv",attrs:{id:"popHeader"}},[e._v("\n        车位信息\n        "),t("i",{staticClass:"el-icon-error",attrs:{id:"i-error"},on:{click:function(r){if(r.target!==r.currentTarget)return null;e.hideOverLayer()}}})]),e._v(" "),t("div",{staticClass:"popDiv",attrs:{id:"popOne"}},[e._v("\n          车位号:"+e._s(e.featureDate.carNum)+"\n      ")]),e._v(" "),t("div",{staticClass:"popDiv",attrs:{id:"popTwo"}},[e._v("\n          分区号:"+e._s(e.featureDate.carArea)+"\n      ")]),e._v(" "),t("div",{staticClass:"popDiv",attrs:{id:"popThree"}},[t("el-button",{staticClass:"popBt",attrs:{type:"primary",size:"mini"},on:{click:e.deleteCar}},[e._v("删除")])],1)])]),e._v(" "),t("el-dialog",{staticClass:"imgSrcDialog",attrs:{title:"查看图片","append-to-body":!0,"lock-scroll":!0,modal:!0,"close-on-click-modal":!1,visible:e.mapVehicle,top:"35vh",width:"30%"},on:{"update:visible":function(r){e.mapVehicle=r},close:e.mapDialog}},[t("div",{staticClass:"map-img"},[t("img",{attrs:{src:e.carNumberSrc}})])])],1)},staticRenderFns:[]};var d=a("Z0/y")(c,l,!1,function(e){a("Hdgg")},"data-v-686eeb66",null);r.default=d.exports}});
//# sourceMappingURL=16.26b8200dd6113872c56f.js.map