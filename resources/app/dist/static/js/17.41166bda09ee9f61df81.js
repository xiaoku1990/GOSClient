webpackJsonp([17],{GOcv:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("fjIZ"),i=a("TgUw"),s=a("CaOM"),n={name:"sensitive-log",data:function(){var e=this,t=new Date;t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0);var a=new Date(t.getTime()-6048e5);return{queryLoading:!1,userQuery:{user_id:0,build_id:this.$BuildId,keyword:"",start_time:Object(r.a)(a,"yyyy-MM-dd"),end_time:Object(r.a)(t,"yyyy-MM-dd"),page:1},tableData:[],tablePageTotal:1,exportLoading:!1,exportFormData:{user_id:0,build_id:this.$BuildId,keyword:"",start_time:0,end_time:0,page:0},exportDateFormat:Object(s.a)().config.tableExportDateFormat,exportFiledArray:{sheetHeaderTitles:["姓名","部门","时间","详情"],sheetHeaderFields:["user_name","user_department","record_time","summary"]},dataPickerOptions1:{disabledDate:function(t){var a=!1;return e.userQuery.end_time&&(a=t.getTime()>new Date(e.userQuery.end_time)),a||t.getTime()>new Date}},dataPickerOptions2:{disabledDate:function(t){var a=!1;return e.userQuery.start_time&&(a=t.getTime()<new Date(e.userQuery.start_time)),a||t.getTime()>new Date}}}},methods:{tablePageChange:function(e){this.updateTable()},updateTable:function(){var e=this;this.queryLoading=!0,this.$http({method:"post",url:this.$Api+"/GOSSystem/getSensitivityLog",params:this.userQuery}).then(function(t){e.queryLoading=!1,1===t.data.result&&(e.tableData=t.data.log_list,e.tablePageTotal=t.data.total_page)}).catch(function(t){e.queryLoading=!1,e.$notify({title:"ERROR",message:""+t,duration:2e3,type:"error"})})},formatTableDate:function(e,t,a){var i=new Date(a);return Object(r.a)(i,"yyyy-MM-dd")},exports:function(){var e=this;this.exportLoading=!0,this.$http({method:"post",url:this.$Api+"/GOSSystem/getSensitivityLog",params:this.exportFormData}).then(function(t){if(e.exportLoading=!1,200==t.status){var a=t.data;if(void 0!==a.result&&1==a.result){var s=a.log_list,n=[],l="敏感操作日志导出_"+Object(r.a)(new Date,e.exportDateFormat);for(var o in s)n[o]={user_name:s[o].user_name,user_department:s[o].user_department,record_time:Object(r.a)(new Date(s[o].record_time),"yyyy-MM-dd"),summary:s[o].summary};Object(i.a)(e,e.exportFiledArray.sheetHeaderTitles,e.exportFiledArray.sheetHeaderFields,n,l)}}else e.$message({message:"导出失败："+data.status,duration:2e3,type:"error"})}).catch(function(t){e.exportLoading=!1,e.$notify({title:"ERROR",message:""+t,duration:2e3,type:"error"})})}},mounted:function(){this.updateTable()}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"the-car-query"},[a("div",{staticClass:"state-from",staticStyle:{display:"flex"}},[a("el-form",{ref:"userQuery",staticStyle:{width:"100%"},attrs:{model:e.userQuery,"label-width":"100px"}},[a("el-form-item",{staticStyle:{width:"30%",float:"left"},attrs:{label:"搜索关键字"}},[a("el-col",{attrs:{span:20}},[a("el-input",{staticClass:"input-round",attrs:{placeholder:"关键字","prefix-icon":"el-icon-search",size:"small",clearable:""},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.updateTable(t):null}},model:{value:e.userQuery.keyword,callback:function(t){e.$set(e.userQuery,"keyword",t)},expression:"userQuery.keyword"}})],1)],1),e._v(" "),a("el-form-item",{staticClass:"data-item",attrs:{label:"日期筛选"}},[a("el-col",{attrs:{span:8}},[a("el-date-picker",{staticClass:"input-round",staticStyle:{width:"100%"},attrs:{"picker-options":e.dataPickerOptions1,editable:!1,clearable:!1,"value-format":"yyyy-MM-dd",size:"small",type:"date"},model:{value:e.userQuery.start_time,callback:function(t){e.$set(e.userQuery,"start_time",t)},expression:"userQuery.start_time"}})],1),e._v(" "),a("el-col",{staticClass:"line",staticStyle:{"text-align":"center"},attrs:{span:1}},[e._v("-")]),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-date-picker",{staticClass:"input-round",staticStyle:{width:"100%"},attrs:{"picker-options":e.dataPickerOptions2,editable:!1,clearable:!1,"value-format":"yyyy-MM-dd",size:"small",type:"date"},model:{value:e.userQuery.end_time,callback:function(t){e.$set(e.userQuery,"end_time",t)},expression:"userQuery.end_time"}})],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search",round:"",loading:e.queryLoading},on:{click:e.updateTable}}),e._v(" "),a("el-button",{attrs:{type:"danger",size:"small",round:"",loading:e.exportLoading},on:{click:e.exports}},[e._v("导出")])],1)],1)],1)]),e._v(" "),a("div",{staticClass:"main-car-padding stor-var"},[a("div",{staticClass:"sensitive-row"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"100%"}},[a("el-table-column",{attrs:{prop:"user_name","empty-text":"暂无数据",label:"姓名",align:"center",width:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"user_department","empty-text":"暂无数据",label:"部门",align:"center",width:""}}),e._v(" "),a("el-table-column",{attrs:{formatter:e.formatTableDate,prop:"record_time","empty-text":"暂无数据",label:"时间",align:"center",width:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"summary","empty-text":"暂无数据",label:"详情",align:"center",width:""}})],1),e._v(" "),a("div",{staticClass:"block"},[a("el-pagination",{attrs:{"current-page":e.userQuery.page,"page-count":e.tablePageTotal,layout:"prev, pager, next, slot, jumper"},on:{"current-change":e.tablePageChange,"update:currentPage":function(t){e.$set(e.userQuery,"page",t)}}},[a("span",{staticClass:"el-pagination__total page-count-padding"},[e._v("共"+e._s(e.tablePageTotal)+"页")])])],1)],1)])])},staticRenderFns:[]};var o=a("Z0/y")(n,l,!1,function(e){a("t34r")},"data-v-45624e14",null);t.default=o.exports},t34r:function(e,t){}});
//# sourceMappingURL=17.41166bda09ee9f61df81.js.map